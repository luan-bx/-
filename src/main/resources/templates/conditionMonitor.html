<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!-- Meta, title, CSS, favicons, etc. -->
    <meta charset="utf-8">
<!--    <meta http-equiv="refresh" content="5" >-->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" th:href="@{/images/favicon.ico}" type="image/ico"/>

    <title>智能一体机 </title>

    <!-- Bootstrap -->
    <link th:href="@{/cdn.datatables.net/1.10.20/css/jquery.dataTables.min.css}">
    <link th:href="@{/vendors/bootstrap/dist/css/bootstrap.min.css}" rel="stylesheet">
    <!-- Font Awesome -->
    <link th:href="@{/vendors/font-awesome/css/font-awesome.min.css}" rel="stylesheet">
    <!-- NProgress -->
    <link th:href="@{/vendors/nprogress/nprogress.css}" rel="stylesheet">
    <!-- iCheck -->
    <link th:href="@{/vendors/iCheck/skins/flat/green.css}" rel="stylesheet">

    <!-- Datatables -->
    <link th:href="@{/vendors/datatables.net-bs/css/dataTables.bootstrap.min.css}" rel="stylesheet">
    <link th:href="@{/vendors/datatables.net-buttons-bs/css/buttons.bootstrap.min.css}" rel="stylesheet">
    <link th:href="@{/vendors/datatables.net-fixedheader-bs/css/fixedHeader.bootstrap.min.css}" rel="stylesheet">
    <link th:href="@{/vendors/datatables.net-responsive-bs/css/responsive.bootstrap.min.css}" rel="stylesheet">
    <link th:href="@{/vendors/datatables.net-scroller-bs/css/scroller.bootstrap.min.css}" rel="stylesheet">

    <!-- Custom Theme Style -->
    <link th:href="@{/build/css/custom.min.css}" rel="stylesheet">


    <!--第一步：引入Javascript / CSS （CDN）-->
    <!-- DataTables CSS -->
    <!--<link rel="stylesheet" type="text/css" href="http://cdn.datatables.net/1.10.21/css/jquery.dataTables.css">

    &lt;!&ndash; jQuery &ndash;&gt;
    <script type="text/javascript" charset="utf8" src="http://code.jquery.com/jquery-1.10.2.min.js"></script>

    &lt;!&ndash; DataTables &ndash;&gt;
    <script type="text/javascript" charset="utf8" src="http://cdn.datatables.net/1.10.21/js/jquery.dataTables.js"></script>-->
</head>

<body class="nav-md">
<div class="container body">
    <div class="main_container">
    
    	<!-- 侧边栏 -->
        <div th:replace="~{blank::menu}"></div>

        <!-- 右上角图标 -->
        <div th:replace="~{blank::top_nav}"></div>

        <!-- 主页面 -->
        <div class="right_col" role="main">
            <div class=""  >
                <div class="page-title">
                    <div class="title_left">
                        <h3><small>工况监测</small></h3>
                    </div>
                </div>

                <div class="clearfix"></div>
                <!-- 分页表格 -->
                <div class="row">
                    <div class="col-md-12 col-sm-12 ">
                        <div class="x_panel">
                            <div class="x_title">
<!--                                <a th:href="@{ '/condition/add'}" class="btn btn-primary btn-sm"><i class="fa fa-plus"></i> 新增监测设备</a>-->
                                <div class="col-sm-4">
                                    <select class="form-control" name="monitorName" id="monitorNameSelect">
                                        <option  th:each="monitor:${allMonitors}" th:value="${monitor}" th:text="${monitor}"></option>
                                    </select>
                                </div>
                                <div class="col-sm-4">
                                    <select class="form-control" name="dateDir" id="dateDirSelect"></select>
                                </div>

                                <ul class="nav navbar-right panel_toolbox">
                                    <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                                    </li>
                                    <li><a class="close-link"><i class="fa fa-close"></i></a>
                                    </li>
                                </ul>
                                <div class="clearfix"></div>
                            </div>
                            <div class="x_content">
                                <div class="row">
                                    <div class="col-sm-12">
                                        <div class="card-box table-responsive">
                                            <table id="table_id_example" class="table table-striped table-bordered" style="width:100%">

                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>




<!--                            <ul class="nav nav-tabs bar_tabs" id="myTab" role="tablist">-->
<!--                                <li class="nav-item">-->
<!--                                    <a class="nav-link" th:classappend="${class}=='conditionOnline'?'active':''" th:href="@{/conditionOnline}" th:aria-selected="${class}=='conditionOnline'">在线数据</a>-->
<!--                                </li>-->
<!--                                <li class="nav-item">-->
<!--                                    <a class="nav-link" th:classappend="${class}=='conditionHistory'?'active':''" th:href="@{/conditionHistory}" th:aria-selected="${class}=='conditionHistory'">历史数据</a>-->
<!--                                </li>-->
<!--                            </ul>-->
<!--                            <div class="tab-content" id="myTabContent" >-->
<!--                                <div class="tab-pane fade show active" th:if="${class}=='conditionOnline'" th:object="${online}" th:with="baseURL='/conditionOnline'">-->

<!--                                    <div class="col-md-6 col-sm-6">-->
<!--                                        <div class="x_panel">-->
<!--                                            <div class="x_title">-->
<!--                                                <h2>Hover rows <small>Try hovering over the rows</small></h2>-->
<!--                                                <ul class="nav navbar-right panel_toolbox">-->
<!--                                                    <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>-->
<!--                                                    </li>-->
<!--                                                    <li class="dropdown">-->
<!--                                                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-wrench"></i></a>-->
<!--                                                        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">-->
<!--                                                            <a class="dropdown-item" href="#">Settings 1</a>-->
<!--                                                            <a class="dropdown-item" href="#">Settings 2</a>-->
<!--                                                        </div>-->
<!--                                                    </li>-->
<!--                                                    <li><a class="close-link"><i class="fa fa-close"></i></a>-->
<!--                                                    </li>-->
<!--                                                </ul>-->
<!--                                                <div class="clearfix"></div>-->
<!--                                            </div>-->
<!--                                            <div class="x_content">-->
<!--                                                <table class="table table-hover">-->
<!--                                                    <thead>-->
<!--                                                    <tr>-->
<!--                                                        <th>#</th>-->
<!--                                                        <th>First Name</th>-->
<!--                                                        <th>Last Name</th>-->
<!--                                                        <th>Username</th>-->
<!--                                                    </tr>-->
<!--                                                    </thead>-->
<!--                                                    <tbody>-->
<!--                                                    <tr>-->
<!--                                                        <th scope="row">1</th>-->
<!--                                                        <td>Mark</td>-->
<!--                                                        <td>Otto</td>-->
<!--                                                        <td>@mdo</td>-->
<!--                                                    </tr>-->
<!--                                                    <tr>-->
<!--                                                        <th scope="row">2</th>-->
<!--                                                        <td>Jacob</td>-->
<!--                                                        <td>Thornton</td>-->
<!--                                                        <td>@fat</td>-->
<!--                                                    </tr>-->
<!--                                                    <tr>-->
<!--                                                        <th scope="row">3</th>-->
<!--                                                        <td>Larry</td>-->
<!--                                                        <td>the Bird</td>-->
<!--                                                        <td>@twitter</td>-->
<!--                                                    </tr>-->
<!--                                                    </tbody>-->
<!--                                                </table>-->

<!--                                            </div>-->
<!--                                        </div>-->
<!--                                    </div>-->



<!--                                </div>-->

<!--                                <div class="tab-pane fade show active" th:if="${class}=='conditionHistory'" th:object="${history}" th:with="baseURL='/conditionHistory'">-->

<!--                                    <div class="row">-->
<!--                                        <div class="col-sm-2" style="margin-top: 10px;">-->
<!--                                            <div class="dataTables_length" >-->
<!--                                                <form id="pageSizeForm" th:action="@{${baseURL}+'/1/'}">-->
<!--                                                    <label>-->

<!--                                                        显示 <select id="pageSize" class="input-sm">-->
<!--                                                        <option value="10" th:selected="*{pageSize} eq '10'">10</option>-->
<!--                                                        <option value="25" th:selected="*{pageSize} eq '25'">25</option>-->
<!--                                                        <option value="50" th:selected="*{pageSize} eq '50'">50</option>-->
<!--                                                        <option value="100" th:selected="*{pageSize} eq '100'">100</option>-->
<!--                                                    </select> 条记录-->

<!--                                                    </label>-->
<!--                                                </form>-->

<!--                                            </div>-->
<!--                                        </div>-->
<!--                                        <div class="col-sm-10">-->
<!--                                            <form th:action="@{/conditionHistory}" method="post">-->
<!--                                                <fieldset>-->
<!--                                                    <div class="control-group">-->
<!--                                                        <div class="controls">-->
<!--                                                            <div class="input-prepend input-group col-sm-2">-->
<!--                                                                <input type="text" name="date" class="form-control" placeholder="日期"  onfocus="(this.type='datetime-local')"  onblur="(this.type='text')" th:value="${date}"/>-->
<!--                                                            </div>-->

<!--                                                            <div class="input-prepend input-group col-sm-2">-->
<!--                                                                <input type="submit" class="btn btn-primary btn-sm" value="搜索" style="margin-top: 5px;">-->
<!--                                                            </div>-->
<!--                                                        </div>-->
<!--                                                    </div>-->
<!--                                                </fieldset>-->
<!--                                            </form>-->
<!--                                        </div>-->
<!--                                    </div>-->

<!--                                    <table class="table">-->
<!--                                        <thead style="text-align: center">-->
<!--                                        <tr>-->
<!--                                            <th>序号</th>-->
<!--                                            <th>采样时间</th>-->
<!--                                            <th>设备</th>-->
<!--                                            <th>i12001</th>-->
<!--                                            <th>i12002</th>-->
<!--                                            <th>i12003</th>-->
<!--                                            <th>i22001</th>-->
<!--                                            <th>i32001</th>-->
<!--                                        </tr>-->
<!--                                        </thead>-->
<!--                                        <tbody id="tbody"></tbody>-->
<!--                                        &lt;!&ndash;                                            <tbody style="text-align: center">&ndash;&gt;-->
<!--                                        &lt;!&ndash;                                            <tr th:each="obj,objStat:*{list}">&ndash;&gt;-->
<!--                                        &lt;!&ndash;                                                <th scope="row" th:text="${objStat.index}+*{startRow}">1</th>&ndash;&gt;-->
<!--                                        &lt;!&ndash;                                                <td th:text="${#dates.format(obj.alarmTime,'yyyy年MM月dd日 HH:mm')}"></td>&ndash;&gt;-->
<!--                                        &lt;!&ndash;                                                <td th:text="${obj.monitor}"></td>&ndash;&gt;-->
<!--                                        &lt;!&ndash;                                                <td th:text="${obj.monitorClass}"></td>&ndash;&gt;-->
<!--                                        &lt;!&ndash;                                                <td th:text="${obj.monitorValue}"></td>&ndash;&gt;-->
<!--                                        &lt;!&ndash;                                                <td th:text="${obj.monitorData}"></td>&ndash;&gt;-->
<!--                                        &lt;!&ndash;                                                <td th:text="${obj.message}"></td>&ndash;&gt;-->
<!--                                        &lt;!&ndash;                                            </tr>&ndash;&gt;-->
<!--                                        &lt;!&ndash;                                            </tbody>&ndash;&gt;-->
<!--                                    </table>-->
<!--                                    <div class="row" th:with="feature=${feature} == null or ${feature} == '' ? '':'/'+${feature}">-->
<!--                                        <div class="col-sm-5">-->
<!--                                            <div class="dataTables_info" id="datatable_info"role="status " aria-live="polite" >第 <span th:text="*{startRow}">1</span> 到 <span th:text="*{endRow}">10</span> 条记录，总计 <span th:text="*{total}">10</span> 条</div>-->
<!--                                        </div>-->
<!--                                        <div class="col-sm-7">-->
<!--                                            <div class="dataTables_paginate paging_simple_numbers" id="datatable_paginate">-->
<!--                                                <ul class="pagination">-->
<!--                                                    <li class="paginate_button previous disabled"id="datatable_previous">-->
<!--                                                        <a th:href="@{${baseURL}+'/1/'+*{pageSize}+${feature}}" aria-controls="datatable" tabindex="0" >首页</a>-->
<!--                                                    </li>-->
<!--                                                    <li class="paginate_button active" th:each="navigatePage:*{navigatepageNums}">-->
<!--                                                        <a th:href="@{${baseURL}+'/'+${navigatePage}+'/'+*{pageSize}+${feature}}" aria-controls="datatable" tabindex="0" th:text="${navigatePage}">1</a>-->
<!--                                                    </li>-->
<!--                                                    <li class="paginate_button next disabled" id="datatable_next">-->
<!--                                                        <a th:href="@{${baseURL}+'/'+*{pages}+'/'+*{pageSize}+${feature}}" aria-controls="datatable" tabindex="0" >尾页</a>-->
<!--                                                    </li>-->
<!--                                                </ul>-->
<!--                                            </div>-->
<!--                                        </div>-->

<!--                                    </div>-->

<!--                                </div>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                            <div class="x_content">-->
<!--                                <div class="row">-->
<!--                                    <div class="col-sm-12">-->
<!--                                        <div class="card-box table-responsive">-->
<!--                                            -->
<!--                                            <table   class="table table-striped table-bordered"-->
<!--                                                   style="width:100%">-->
<!--                                                <thead>-->
<!--                                                <tr>-->
<!--                                                    <th>序号</th>-->
<!--                                                    <th>采样时间</th>-->
<!--                                                    <th>设备</th>-->
<!--                                                    <th>i12001</th>-->
<!--                                                    <th>i12002</th>-->
<!--                                                    <th>i12003</th>-->
<!--                                                    <th>i22001</th>-->
<!--                                                    <th>i32001</th>-->
<!--                                                </tr>-->
<!--                                                </thead>-->
<!--                                                <tbody id="tbody"></tbody>-->
<!--                                            </table>-->
<!--                                        </div>-->
<!--                                    </div>-->
<!--                                </div>-->

<!--                            </div>-->
                        </div>
                    </div>


                </div>
                <br/>

            </div>
        </div>
        <!-- 主页面结束 -->

        <!-- footer content 页脚-->
        <!--        <footer>-->
        <!--          <div class="pull-middle">-->
        <!--            Gentelella - Bootstrap Admin Template by <a th:href="@{/https://colorlib.com">Colorlib</a>-->
        <!--          </div>-->
        <!--          <div class="clearfix"></div>-->
        <!--        </footer>-->
        <!-- /footer content -->
    </div>
</div>

    <!-- jQuery -->
    <script th:src="@{/vendors/jquery/dist/jquery.min.js}"></script>
    <!-- Bootstrap -->
    <script th:src="@{/vendors/bootstrap/dist/js/bootstrap.bundle.min.js}"></script>
    <!-- FastClick -->
    <script th:src="@{/vendors/fastclick/lib/fastclick.js}"></script>
    <!-- NProgress -->
    <script th:src="@{/vendors/nprogress/nprogress.js}"></script>
    <!-- iCheck -->
    <script th:src="@{/vendors/iCheck/icheck.min.js}"></script>
    <!-- Datatables -->
    <script th:src="@{/vendors/datatables.net/js/jquery.dataTables.min.js}"></script>
    <script th:src="@{/vendors/datatables.net-bs/js/dataTables.bootstrap.min.js}"></script>
    <script th:src="@{/vendors/datatables.net-buttons/js/dataTables.buttons.min.js}"></script>
    <script th:src="@{/vendors/datatables.net-buttons-bs/js/buttons.bootstrap.min.js}"></script>
    <script th:src="@{/vendors/datatables.net-buttons/js/buttons.flash.min.js}"></script>
    <script th:src="@{/vendors/datatables.net-buttons/js/buttons.html5.min.js}"></script>
    <script th:src="@{/vendors/datatables.net-buttons/js/buttons.print.min.js}"></script>
    <script th:src="@{/vendors/datatables.net-fixedheader/js/dataTables.fixedHeader.min.js}"></script>
    <script th:src="@{/vendors/datatables.net-keytable/js/dataTables.keyTable.min.js}"></script>
    <script th:src="@{/vendors/datatables.net-responsive/js/dataTables.responsive.min.js}"></script>
    <script th:src="@{/vendors/datatables.net-responsive-bs/js/responsive.bootstrap.js}"></script>
    <script th:src="@{/vendors/datatables.net-scroller/js/dataTables.scroller.min.js}"></script>
    <script th:src="@{/vendors/jszip/dist/jszip.min.js}"></script>
    <script th:src="@{/vendors/pdfmake/build/pdfmake.min.js}"></script>
    <script th:src="@{/vendors/pdfmake/build/vfs_fonts.js}"></script>

    <!-- Custom Theme Scripts -->
    <script th:src="@{/build/js/custom.min.js}"></script>

<script th:inline="javascript">
    /*<![CDATA[*/
    var msg = /*[[${msg}]]*/null;
    if(msg!=null){
        alert(msg);
    }
    /*]]>*/
</script>

<script type="text/javascript" th:inline="javascript">
    window.alert = function() {
        return false;
    }
    $(function (){
        $("#pageSize").change(function(){
            $("#pageSizeForm").attr({'action':$("#pageSizeForm").attr('action')+$("#pageSize option:selected").val()})
            $("#pageSizeForm").submit();
        });
        callDateDirs();
        $("#monitorNameSelect").change(function (){
            callDateDirs();
            callConditionData(2);
        });
        callConditionData(1);
        $("#dateDirSelect").change(function (){
            callConditionData(2);
        });
    });
</script>


<script th:inline="javascript" th:with="zh=@{/json/zh.json}">



    function callDateDirs(){
        $.ajaxSettings.async = false;
        $.post("/returnConditionFileList","monitorName="+$("#monitorNameSelect").val(),function (result){
            $("#dateDirSelect").empty();
            for (var i=0;i<result.length;i++){
                $("#dateDirSelect").append("<option value='"+ result[i] +"'>"+ result[i] +"</option>");
            }
        });
        $.ajaxSettings.async = true;
    }

    function callConditionData(cnt){
        console.log("monitorName="+$("#monitorNameSelect").val());
        console.log("dir="+$("#dateDirSelect").val());
        $.post("/returnConditionData","monitorName="+$("#monitorNameSelect").val()+"&dir="+$("#dateDirSelect").val(),function(result){
            if(cnt!==1){
                $('#table_id_example').DataTable().clear();
                $('#table_id_example').DataTable().destroy();
                $('#table_id_example').empty();
            }
            createDatatable(result);
        } );
    }

    function createDatatable(result) {
        var obj = JSON.parse(result);
        var col = [];
        $("#table_id_example").append("<thead>\n" +
            "<tr id=\"table_head\">\n" +
            "</tr>\n" +
            "</thead>");
        for (var i=0;i< obj.keySet.length;i++){
            $('#table_head').append("<th>"+obj.keySet[i]+"</th>");
            col[i]="{\"data\":\""+obj.keySet[i]+"\"}"
            col[i]=JSON.parse(col[i]);
        }


        console.log(col);
        $('#table_id_example').DataTable({
            /*"columns":[  //绑定的数据源，后台的json数据里必须有这些属性，保持一致性
                {"data":"accountNum"},
                {"data":"userName"},
                {"data":"unit"},
                {"data":"authority"},
                {"data":"time"}
            ],*/
            "scrollX": true,
            columns: col,
            data: obj.data,
            language: {
                url: [[${zh}]],
            },
        });
    }


    // var response = [];
    // $.post("/returnConditionData",function(result){
    //     response=result.split("  ");
    //     console.log(response);
    //     for(var i=1; i<response.length; i++)
    //     {
    //         response[i]=JSON.parse(response[i]);
    //         let time = response[i]["DataTime"];
    //         let deviceID = response[i]["MN"];
    //         let value0 = response[i]['CP']['i12001-Info'];
    //         let value1 = response[i]['CP']['i12002-Info'];
    //         let value2 = response[i]['CP']['i12003-Info'];
    //         let value3 = response[i]['CP']['i22001-Info'];
    //         let value4 = response[i]['CP']['i32001-Info'];
    //         let str = "<tr>" +
    //                       "<td>"+i+"</td>" +
    //                       "<td>"+time+"</td>" +
    //                       "<td>"+deviceID+"</td>" +
    //                       "<td>"+value0+"</td>" +
    //                       "<td>"+value1+"</td>" +
    //                       "<td>"+value2+"</td>" +
    //                       "<td>"+value3+"</td>" +
    //                       "<td>"+value4+"</td>" +
    //                   "</tr>";
    //         $("#tbody").append(str);
    //     }
    //
    // });
</script>



</body>
</html>
